(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class W{constructor(t){this.mediaQueries=t}initSlider({btnNext:t=null,btnPrev:e=null,slider:n,item:s,itemLength:r}){this.flagDragDropMouse=!1,this.flagDragDropTouch=!1,this.windowWidth=document.documentElement.clientWidth,this.elemItem=s,this.elemBtnNext=t,this.elemBtnPrev=e,this.elemSlider=n,this.stepNumber=1,this.position=0,this.sliderLength=r,this.visibleSlides=this.getVisibleSlidesMediaQueries(this.mediaQueries),this.distance=this.updateWidthItem(),this.setTotalSteps(),this.onResize=this.handleResize.bind(this),this.onDOMLoaded=this.handleDOMLoaded.bind(this),document.addEventListener("DOMContentLoaded",this.onDOMLoaded),window.addEventListener("resize",this.onResize),this.elemBtnNext&&this.elemBtnPrev&&(this.onclickNext=this.handleClickNext.bind(this),this.onclickPrev=this.handleClickPrev.bind(this),this.elemBtnNext.addEventListener("click",this.onclickNext),this.elemBtnPrev.addEventListener("click",this.onclickPrev))}dispatchSlideChangeEvent(){const t=new CustomEvent("slideChanged",{bubbles:!0,detail:{currentStep:this.stepNumber,totalSteps:this.totalSteps}});this.elemSlider.dispatchEvent(t)}initStepsCallback(t){this.callBackSteps=t}initResizeCallback(t){this.callBackResize=t}removeAllListener(){document.removeEventListener("DOMContentLoaded",this.onDOMLoaded),window.removeEventListener("resize",this.onResize),this.elemBtnNext&&this.elemBtnPrev&&(this.elemBtnNext.removeEventListener("click",this.onclickNext),this.elemBtnPrev.removeEventListener("click",this.onclickPrev)),this.flagDragDropMouse&&(this.elemSlider.removeEventListener("mousedown",this.onmousedown),this.elemSlider.removeEventListener("mousemove",this.onmousemove),document.removeEventListener("mouseup",this.onmouseup)),this.flagDragDropTouch&&(this.elemSlider.removeEventListener("touchstart",this.ontouchstart),this.elemSlider.removeEventListener("touchmove",this.ontouchmove),document.removeEventListener("touchend",this.ontouchend))}handleClickNext(){this.moveNext(),this.updateButtonStates(),this.setSlideStep()}handleClickPrev(){this.movePrev(),this.updateButtonStates(),this.setSlideStep()}handleResize(){let t=document.documentElement.clientWidth;t!==this.windowWidth&&(this.resetSlider(),this.distance=this.updateWidthItem(),this.visibleSlides=this.getVisibleSlidesMediaQueries(this.mediaQueries),this.updateButtonStates(),this.setTotalSteps(),this.windowWidth=t,this.dispatchSlideChangeEvent(),this.callBackResize&&this.callBackResize(),this.callBackSteps&&this.callBackSteps(this.stepNumber,this.totalSteps))}handleDOMLoaded(){this.updateButtonStates(),this.setTotalSteps(),this.dispatchSlideChangeEvent(),this.callBackSteps&&this.callBackSteps(this.stepNumber,this.totalSteps)}initDragDrop(t=!1){this.flagDragDropTouch=!0,this.isDragging=!1,this.touchStart=0,this.touchEnd=0,this.touchMove=0,this.ontouchstart=this.handleStart.bind(this),this.ontouchmove=this.handleMove.bind(this),this.ontouchend=this.handleEnd.bind(this),this.elemSlider.addEventListener("touchstart",this.ontouchstart,{passive:!1}),this.elemSlider.addEventListener("touchmove",this.ontouchmove,{passive:!1}),document.addEventListener("touchend",this.ontouchend),t&&(this.flagDragDropMouse=!0,this.onmousedown=this.handleStart.bind(this),this.onmousemove=this.handleMove.bind(this),this.onmouseup=this.handleEnd.bind(this),this.elemSlider.addEventListener("mousedown",this.onmousedown,{passive:!1}),this.elemSlider.addEventListener("mousemove",this.onmousemove,{passive:!1}),document.addEventListener("mouseup",this.onmouseup))}handleStart(t){t.preventDefault();const e=t.touches?t.touches[0].clientX:t.clientX;this.startDragDrop(e)}handleMove(t){if(!this.isDragging)return;const e=t.touches?t.touches[0].clientX:t.clientX;this.moveDragDrop(e)}handleEnd(t){this.isDragging&&this.endDragDrop()}startDragDrop(t){this.isDragging=!0,this.touchStart=t}moveDragDrop(t){this.touchMove=t-this.touchStart+this.position,this.animateSlider(this.elemSlider,this.touchMove),this.touchEnd=t}endDragDrop(){this.isDragging=!1,this.position=this.touchMove,setTimeout(()=>{this.position>0?(this.animateSlider(this.elemSlider,0),this.position=0,this.setSlideStep()):this.position<this.sliderEnd()?(this.animateSlider(this.elemSlider,this.sliderEnd()),this.position=this.sliderEnd(),this.setSlideStep()):this.touchEnd-this.touchStart<-20?(this.position=this.distance*Math.floor(this.position/this.distance),this.setSlideStep(),this.animateSlider(this.elemSlider,this.position)):this.touchEnd-this.touchStart>20?(this.position=this.distance*Math.ceil(this.position/this.distance),this.setSlideStep(),this.animateSlider(this.elemSlider,this.position)):(this.position=this.distance*Math.round(this.position/this.distance),this.animateSlider(this.elemSlider,this.position)),this.updateButtonStates(),this.dispatchSlideChangeEvent()},100)}sliderEnd(){return-(this.sliderLength*this.distance-this.visibleSlides*this.distance)}setTotalSteps(){this.totalSteps=this.sliderLength-this.visibleSlides+1}setSlideStep(){if(this.position>0)return;const t=Math.abs(this.position/this.distance)+1;this.stepNumber=t,this.callBackSteps&&this.callBackSteps(this.stepNumber,this.totalSteps),this.dispatchSlideChangeEvent()}getVisibleSlidesMediaQueries(t){for(let e=0;e<t.length;e++){const n=t[e];for(let s in n)if(n.hasOwnProperty(s)&&n[s].matches)return parseInt(s)}}updateWidthItem(){return this.elemItem.offsetWidth}updateButtonStates(){this.elemBtnNext&&(this.elemBtnNext.disabled=this.position<=this.sliderEnd()),this.elemBtnPrev&&(this.elemBtnPrev.disabled=this.position>=0)}moveNext(){const t=this.visibleSlides*this.distance-this.distance*this.sliderLength;this.position<=t||(this.position=this.position-this.distance,this.animateSlider(this.elemSlider,this.position))}movePrev(){this.position!==0&&(this.position=this.position+this.distance,this.animateSlider(this.elemSlider,this.position))}animateSlider(t,e){requestAnimationFrame(()=>{t.style.transform=`translateX(${e}px)`})}resetSlider(){this.stepNumber=1,this.position=0,this.animateSlider(this.elemSlider,this.position)}}const q=(i,t)=>{i.forEach(e=>{e.classList.remove(t)})},x=i=>{i.innerHTML=""};function A(i,t){return i.map(e=>t.render(e))}const j=()=>window.innerWidth-document.documentElement.clientWidth,O=()=>{const i=j();document.documentElement.classList.add("no-scroll"),document.body.classList.add("no-scroll"),i>0&&(document.body.style.paddingRight=`${i}px`)},D=()=>{document.documentElement.classList.remove("no-scroll"),document.body.classList.remove("no-scroll"),document.body.style.paddingRight=""};function R(){const i=[{1:window.matchMedia("(min-width: 1px)")}],t={btnNext:document.querySelector(".slider__btn--next"),btnPrev:document.querySelector(".slider__btn--prev"),slider:document.querySelector(".slider__track"),itemLength:document.querySelectorAll(".slider__item").length,item:document.querySelector(".slider__item")},e=new W(i),n={containerSelector:".slider__container-icons",classNameIcon:"slider__icon",length:t.itemLength};e.initSlider(t),e.initDragDrop("desktop"),(({containerSelector:c,classNameIcon:N,length:w})=>{const y=new DocumentFragment,v=document.querySelector(c);for(let u=0;u<w;u++){const b=document.createElement("div");b.className=N,y.append(b)}v.append(y)})(n);const r=document.querySelectorAll(".slider__icon");t.slider.addEventListener("slideChanged",c=>{q(r,"slider__icon--active"),r[c.detail.currentStep-1].classList.add("slider__icon--active"),c.detail.currentStep===1?t.btnPrev.setAttribute("aria-label","Предыдущий слайд недоступен"):t.btnPrev.setAttribute("aria-label","Предыдущий слайд"),c.detail.currentStep===c.detail.totalSteps?t.btnNext.setAttribute("aria-label","Следующий слайд недоступен"):t.btnNext.setAttribute("aria-label","Следующий слайд")})}class z{constructor(t,e={}){this.api=t,this.options=e}async getData(){try{const t=await fetch(this.api,this.options);if(t.ok)return await t.json();throw t.status===404?new Error("404, Not found"):t.status===500?new Error("500, internal server error"):new Error(t.status)}catch(t){console.error("Fetch",t)}}}class Q{constructor(t){this.localStorageKey="cart",this.cart=this.loadCart(),this.report=t}loadCart(){const t=localStorage.getItem(this.localStorageKey);return t?JSON.parse(t):{}}saveCart(){localStorage.setItem(this.localStorageKey,JSON.stringify(this.cart))}add(t,e=1){e<=0||(this.cart[t]||(this.cart[t]=0),this.cart[t]+=e,this.saveCart(),this.report())}remove(t,e=1){e<=0||this.cart[t]&&(this.cart[t]-=e,this.cart[t]<=0&&delete this.cart[t],this.saveCart(),this.report())}removeAll(t){console.log(t,"removeAll",this.cart),this.cart[t]&&(delete this.cart[t],this.saveCart(),this.report())}clear(){this.cart={},this.saveCart(),this.report()}getQuantityProduct(){return Object.values(this.cart).reduce((t,e)=>t+e,0)}getLengthCart(){return Object.keys(this.cart).length}getProductsInCart(t){return t.reduce((e,n)=>(this.cart[n.id]&&e.push(n),e),[])}getSumPriceInCart(t,e){return t.reduce((n,s)=>(e[s.id]&&(n=n+s.price*e[s.id]),n),0)}}const f=new Q(M),X=document.getElementById("cart-count");function M(){const i=f.getQuantityProduct();X.textContent=i>99?99:i}M();class H{_data=[];constructor(t=[]){this._data=t}get data(){return this._data}set data(t){this._data=t}}const E=new H;class T{constructor({elements:t=[],classNameCard:e="card",titleTag:n="div",currencySymbol:s="₽",extensionImg:r="png"}){const c=["div","h1","h2","h3","h4","h5","h6","p","span"];this.titleTag=c.includes(n)?n:"div",this.elements=t,this.classNameCard=e,this.currencySymbol=s,this.extensionImg=r}_createImg(t){const e=document.createElement("img");return e.className=`${this.classNameCard}__img`,e.src=`/colors/images/${t.img_name}.${this.extensionImg}`,e.alt=t.name,e}_createArticle(t){const e=document.createElement("article");return e.setAttribute("data-product-id",t.id),e.className=this.classNameCard,e}_createPrice(t){const e=document.createElement("span");return e.className=`${this.classNameCard}__price`,e.textContent=`${t.price} ${this.currencySymbol}`,e}_createTitle(t){const e=document.createElement(this.titleTag);return e.className=`${this.classNameCard}__title`,e.textContent=t.name,e}render(t){if(!t)throw new Error("Error product parameters");const e=this._createArticle(t),n=document.createElement("header");n.className=`${this.classNameCard}__header`;const s=document.createElement("div");s.className=`${this.classNameCard}__image-wrapper`,s.append(this._createImg(t)),n.append(s),n.append(this._createTitle(t));const r=document.createElement("footer");return r.className=`${this.classNameCard}__footer`,r.append(this._createPrice(t)),this.elements.length&&this.elements.forEach(c=>{r.append(c.render())}),e.append(n,r),e}}class k{constructor({className:t,text:e="",tag:n="div",attrs:s={}}){this.className=t,this.text=e,this.tag=n,this.attrs=s}render(){const t=document.createElement(this.tag);return this.className&&(t.className=this.className),this.text&&(t.textContent=this.text),this.productId&&(t.dataset.productId=this.productId),Object.entries(this.attrs).forEach(([e,n])=>{t.setAttribute(e,n)}),t}}class K{sort(t,e="asc"){throw new Error("Sort method should be implemented!")}}class U extends K{constructor(t){super(),this.field=t}sort(t,e="asc"){if(!Array.isArray(t))throw new Error("Expected an array");const n=t.map(s=>({...s}));if(e==="asc")return n.sort((s,r)=>s[this.field]-r[this.field]);if(e==="desc")return n.sort((s,r)=>r[this.field]-s[this.field]);throw new Error("Invalid sort order")}}class V{filter(t,e){throw new Error("Filter method should be implemented!")}}class J extends V{filter(t,e){return t.filter(s=>{let r=!0;for(const c in e)if(Object.hasOwnProperty.call(e,c)&&s[c]!==e[c]){r=!1;break}return r})}}function F(i,t){return t[i%100>4&&i%100<20?2:[2,0,1,1,1,2][i%10<5?Math.abs(i)%10:5]]}function G(){const i=document.querySelector(".list-products"),t=document.getElementById("filtersForm"),e=document.querySelector(".sort"),n=document.querySelector(".sort__selected"),s=document.querySelector(".sort__selected-text"),r=document.querySelector(".sort__items"),c=document.querySelectorAll(".sort__item"),N="https://687750f0dba809d901eeb0be.mockapi.io/api/colors",w={headers:{Accept:"application/json"}},y=new z(N,w),v={};let u=[];const b={state:{price:"desc"}},P={quantityNumber:document.getElementById("paint-count"),quantityText:document.getElementById("paint-label"),callback:F,arrVal:["товар","товара","товаров"]},B=new k({tag:"button",className:"product__btn  cart-button cart-button--add sr-only-text",text:"добавить в корзину"}),_=new T({elements:[B],classNameCard:"product",titleTag:"h2"}),L=new U("price"),S=new J;(async()=>{try{if(E.data=await y.getData(),!E.data.length)return;const o=L.sort(E.data,"desc");a(o,i),C(P,o)}catch(o){console.log(o)}})();const C=({quantityNumber:o,quantityText:l,callback:m,arrVal:g},$)=>{o.textContent=$.length,l.textContent=m($.length,g)},a=(o,l)=>{const m=A(o,_);l.appendChild(p(m))},p=o=>{const l=new DocumentFragment;for(let m=0;m<o.length;m++){const g=document.createElement("li");g.className="list-products__item",g.append(o[m]),l.append(g)}return l};i.addEventListener("click",o=>{const l=o.target,m=l.closest(".product");if(!m)return;const g=m.dataset.productId;g&&l.classList.contains("cart-button--add")&&f.add(g)}),t.addEventListener("change",o=>{const l=o.target;l.checked&&!v[l.value]?v[l.value]=l.checked:v[l.value]&&!l.checked&&delete v[l.value],u=S.filter(E.data,v),u.length?(x(i),u=L.sort(u,b.state.price),a(u,i),C(P,u)):x(i)}),document.addEventListener("click",o=>{e.contains(o.target)||(r.classList.remove("sort__items--open"),e.setAttribute("aria-expanded","false"))}),n.addEventListener("click",o=>{o.stopPropagation(),r.classList.add("sort__items--open"),e.setAttribute("aria-expanded","true")}),r.addEventListener("click",o=>{if(!o.target.classList.contains("sort__item"))return;q(c,"sort__item--selected"),o.target.classList.add("sort__item--selected"),r.prepend(o.target),s.textContent=o.target.textContent,e.dataset.value=o.target.dataset.value,x(i);const[l,m]=o.target.dataset.value.split(":");u=S.filter(E.data,v);const g=L.sort(u,m);b.state[l]=m,a(g,i),C(P,g)});const d=document.querySelector(".products__filter-btn"),h=document.querySelector(".products__overlay-filter");d.addEventListener("click",()=>{h.classList.add("products__overlay-filter--active")}),h.addEventListener("click",o=>{o.target===h&&h.classList.remove("products__overlay-filter--active")})}class Y extends T{constructor(t){super(t)}render(t){if(!t)throw new Error("Error product parameters");const e=this._createArticle(t),n=document.createElement("div");n.className=`${this.classNameCard}__left`,n.append(this._createImg(t));const s=document.createElement("div");s.className=`${this.classNameCard}__center`,s.append(this._createTitle(t),this._createPrice(t));const r=document.createElement("div");return r.className=`${this.classNameCard}__right`,this.elements.length&&this.elements.forEach(c=>{r.append(c.render())}),e.append(n,s,r),e}}function Z(){const i=document.getElementById("cart"),t=document.querySelector(".panel-aside"),e=document.querySelector(".panel-aside__products-list"),n=document.querySelector(".panel-aside__close-btn"),s=document.querySelector(".panel-aside__cart-quantity"),r=document.querySelector(".panel-aside__cart-clear-btn"),c=document.querySelector(".panel-aside__total-price"),N=new k({className:"product-cart__btn  cart-button cart-button--increase sr-only-text",text:"увеличить"}),w=new k({className:"product-cart__btn cart-button cart-button--decrease sr-only-text",text:"уменьшить"}),y=new k({className:"product-cart__quantity"}),v=new Y({elements:[N,y,w],classNameCard:"product-cart"});let u={};const b=a=>{const p=new DocumentFragment;for(let d=0;d<a.length;d++){const h=document.createElement("li");h.className="panel-aside__product-item",h.append(a[d]),h.append(P()),h.append(B()),p.append(h)}return p},P=()=>{const a=document.createElement("button");return a.className="panel-aside__item-delete",a.setAttribute("aria-label","удалить товар"),a},B=()=>{const a=document.createElement("button");return a.className="panel-aside__item-restore d-none",a.setAttribute("aria-label","восстановить товар"),a},_=(a=null)=>{const p=a!==null?a:f.getQuantityProduct(),d=F(p,["товар","товара","товаров"]);s.textContent=p+" "+d},L=()=>{for(const a in u)Object.hasOwnProperty.call(u,a)&&f.removeAll(a)},S=()=>{const a={...f.cart};for(const d in u)Object.hasOwnProperty.call(u,d)&&delete a[d];return f.getSumPriceInCart(E.data,a).toFixed(2)+"₽"},I=()=>{const a={...f.cart};for(const d in u)Object.hasOwnProperty.call(u,d)&&delete a[d];return Object.values(a).reduce((d,h)=>d+h,0)},C=({target:a,itemList:p,product:d,productId:h,stateDelete:o},l,m)=>{const g=p.querySelector(l);a.classList.add("d-none"),g.classList.remove("d-none"),m==="delete"?(o[h]=f.cart[h],d.classList.add("ghost-mode")):(delete o[h],d.classList.remove("ghost-mode"))};t.addEventListener("click",a=>{a.target===t&&(t.classList.add("panel-aside--hidden"),x(e),D(),L(),u={})}),e.addEventListener("click",a=>{const p=a.target,d=p.closest(".panel-aside__product-item");if(!d)return;const h=d.querySelector(".product-cart"),o=h.dataset.productId,l=h.querySelector(".product-cart__quantity");if(!o)return;const m={target:p,itemList:d,product:h,productId:o,stateDelete:u};if(a.target.classList.contains("panel-aside__item-delete")){C(m,".panel-aside__item-restore","delete"),c.textContent=S(),_(I());return}if(a.target.classList.contains("panel-aside__item-restore")){C(m,".panel-aside__item-delete","restore"),c.textContent=S(),_(I());return}if(a.target.classList.contains("cart-button--increase")&&(f.add(o),l.textContent=f.cart[o],c.textContent=S(),_()),a.target.classList.contains("cart-button--decrease")){if(f.cart[o]<=1)return;f.remove(o),l.textContent=f.cart[o],c.textContent=S(),_()}}),i.addEventListener("click",()=>{t.classList.remove("panel-aside--hidden"),_();const a=f.getProductsInCart(E.data),p=A(a,v);e.append(b(p)),document.querySelectorAll(".product-cart__quantity").forEach(h=>{const l=h.closest(".product-cart").dataset.productId;h.textContent=f.cart[l]}),c.textContent=S(),O()}),n.addEventListener("click",a=>{a.stopPropagation(),t.classList.add("panel-aside--hidden"),x(e),L(),u={},D()}),r.addEventListener("click",()=>{u={},f.clear(),e.innerHTML="",c.textContent="0₽",s.textContent="0 товаров"})}function tt(){const i=document.querySelector(".burger-btn"),t=document.querySelector(".header__mobile-menu"),e=document.createElement("div");e.classList.add("overlay"),i.addEventListener("click",n=>{n.stopPropagation(),i.classList.toggle("burger-btn--active"),t.classList.toggle("header__mobile-menu--active"),i.classList.contains("burger-btn--active")?(document.body.append(e),O()):(e.remove(),D())}),document.addEventListener("click",n=>{n.target===e&&(i.classList.remove("burger-btn--active"),t.classList.remove("header__mobile-menu--active"),e.remove(),D())})}R();G();Z();tt();
